{% extends "admin/login.html" %}
{% load static %}

{% block extrastyle %}
{{ block.super }}
<style>
    /* Скрываем кнопку "Return to site" */
    a[href="/"]:not(.logo),
    .login-page a[href="/"],
    .login-page .site-link,
    .login-page .return-link {
        display: none !important;
    }
    
    /* Скрываем переключатель темы на странице входа - все возможные варианты */
    .login-page [class*="theme"],
    .login-page [class*="dark-mode"],
    .login-page [class*="light-mode"],
    .login-page [class*="Theme"],
    .login-page button[aria-label*="theme"],
    .login-page button[aria-label*="Theme"],
    .login-page button[title*="theme"],
    .login-page button[title*="Theme"],
    .login-page [data-theme-toggle],
    .login-page .theme-toggle,
    .login-page .dark-mode-toggle,
    .login-page [id*="theme"],
    .login-page [id*="Theme"],
    .login-page header button,
    .login-page header button:last-child,
    .login-page header [class*="toggle"],
    .login-page .unfold-header button,
    .login-page .unfold-header button:last-child,
    .login-page header > button,
    .login-page [role="button"][aria-label*="theme"],
    .login-page [role="button"][aria-label*="Theme"],
    .login-page svg[class*="theme"],
    .login-page [class*="icon"][class*="theme"],
    /* Скрываем переключатель темы в форме входа */
    .login-box [class*="theme"],
    .login-box .theme-toggle,
    .login-box button[aria-label*="theme"],
    .login-box button[title*="theme"],
    .login-box [class*="toggle"],
    .login-box button:has(svg),
    .login-box button:has([class*="theme"]),
    /* Скрываем все кнопки в header кроме логотипа */
    .login-page header > *:not(a):not([class*="logo"]):not([class*="brand"]),
    /* Скрываем переключатель темы везде на странице входа */
    .login-page *[class*="theme-toggle"],
    .login-page *[class*="theme"]:not([class*="theme-toggle"]),
    .login-page button:has(svg[class*="theme"]),
    .login-page button:has([class*="theme"]) {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        pointer-events: none !important;
        width: 0 !important;
        height: 0 !important;
        overflow: hidden !important;
    }
    
    /* Дефолтный стиль Unfold - темный фон */
    .login-page {
        background: #0E1829 !important;
        min-height: 100vh !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        padding: 20px !important;
    }
    
    /* Скрываем логотип на странице входа */
    .login-box-msg img,
    .login-box-msg .brand-image,
    .login-page img[src*="logo"],
    .login-page [class*="logo"],
    .login-page [class*="brand"],
    .login-page header img,
    .login-page header [class*="logo"],
    .login-page header [class*="brand"] {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
    }
    
    .login-box-msg {
        text-align: center !important;
        margin-bottom: 40px !important;
    }
    
    /* Скрываем стандартный заголовок Unfold, если он есть */
    .login-box-msg h1 {
        display: none !important;
    }
    
    /* Форма входа - простая и чистая, без рамок и белого фона */
    .login-box,
    .login-box .card,
    .login-box .card-body,
    .login-box form,
    .login-box > div,
    .login-box > * {
        background: transparent !important;
        background-color: transparent !important;
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important;
        max-width: 400px !important;
        width: 100% !important;
        margin: 0 auto !important;
    }
    
    /* Убираем все белые фоны и рамки */
    .login-page .card,
    .login-page .card-body,
    .login-page [class*="card"],
    .login-page [class*="box"]:not(.login-box-msg) {
        background: transparent !important;
        background-color: transparent !important;
        border: none !important;
        box-shadow: none !important;
    }
    
    /* Поля ввода - СЕРЫЙ фон, НЕ зеленый! */
    .form-control,
    input[type="text"],
    input[type="password"],
    input[type="email"] {
        background-color: #2d3136 !important;
        background: #2d3136 !important;
        background-image: none !important;
        border: none !important;
        border-radius: 8px !important;
        color: white !important;
        padding: 12px 15px !important;
        font-size: 14px !important;
    }
    
    .form-control:focus,
    input[type="text"]:focus,
    input[type="password"]:focus,
    input[type="email"]:focus {
        background-color: #2d3136 !important;
        background: #2d3136 !important;
        border: none !important;
        color: white !important;
        box-shadow: none !important;
        outline: none !important;
    }
    
    .form-control::placeholder {
        color: rgba(255, 255, 255, 0.5) !important;
    }
    
    /* Метки полей - белый цвет */
    label {
        color: white !important;
        font-weight: 400 !important;
        margin-bottom: 8px !important;
        display: block !important;
        font-size: 14px !important;
    }
    
    /* Кнопка входа - ЗЕЛЕНЫЙ цвет #26A17B */
    .btn-primary,
    input[type="submit"],
    button[type="submit"] {
        background-color: #26A17B !important;
        background: #26A17B !important;
        background-image: none !important;
        border: none !important;
        color: white !important;
        border-radius: 8px !important;
        padding: 12px 30px !important;
        font-weight: 400 !important;
        font-size: 14px !important;
        width: 100% !important;
        transition: all 0.2s ease !important;
    }
    
    .btn-primary:hover,
    input[type="submit"]:hover,
    button[type="submit"]:hover {
        background-color: #1d7a5d !important;
        background: #1d7a5d !important;
        border: none !important;
        color: white !important;
    }
    
    /* Заменяем фиолетовые цвета в ТЕКСТЕ на зеленый (НЕ в полях ввода!) */
    .login-box-msg h2,
    .login-box-msg h3,
    .login-box-msg strong,
    .login-box-msg b,
    .login-box-msg p strong,
    .login-box-msg [class*="text-primary"],
    .login-box-msg [class*="primary"]:not(.btn-primary):not(.form-control),
    /* Принудительно заменяем фиолетовый цвет в "City Exchange Admin" */
    .login-page h2,
    .login-page h3,
    .login-page strong,
    .login-page b,
    .login-page [style*="purple"],
    .login-page [style*="violet"],
    .login-page [style*="#667eea"],
    .login-page [style*="#764ba2"],
    .login-page [style*="#6f42c1"],
    .login-page [style*="#7c3aed"],
    .login-page [style*="#8b5cf6"] {
        color: #26A17B !important;
    }
    
    /* Скрываем приветственное сообщение, если оно есть */
    .login-box-msg p,
    .login-box-msg .welcome-text {
        display: none !important;
    }
    
    /* Группы полей */
    .form-group {
        margin-bottom: 20px !important;
    }
    
    /* Адаптивность */
    @media (max-width: 480px) {
        .login-box {
            padding: 0 10px !important;
        }
    }
</style>
{% endblock %}

{% block bodyclass %}{{ block.super }} login-page{% endblock %}

{% block extrahead %}
{{ block.super }}
<script>
    // Принудительно устанавливаем темную тему на странице входа и блокируем переключение
    (function() {
        // Устанавливаем темную тему сразу
        document.documentElement.setAttribute('data-theme', 'dark');
        document.body.setAttribute('data-theme', 'dark');
        document.documentElement.classList.remove('light');
        document.documentElement.classList.add('dark');
        document.documentElement.style.colorScheme = 'dark';
        
        // Сохраняем в localStorage
        if (localStorage) {
            localStorage.setItem('theme', 'dark');
            localStorage.setItem('unfold-theme', 'dark');
            localStorage.setItem('data-theme', 'dark');
        }
        
        // Функция для скрытия переключателя темы
        function hideThemeToggle() {
            const themeButtons = document.querySelectorAll(
                '[class*="theme"], [id*="theme"], button[aria-label*="theme"], button[title*="theme"], .theme-toggle, [data-theme-toggle]'
            );
            themeButtons.forEach(btn => {
                btn.style.display = 'none';
                btn.style.visibility = 'hidden';
                btn.style.opacity = '0';
                btn.style.pointerEvents = 'none';
                btn.style.width = '0';
                btn.style.height = '0';
                btn.style.overflow = 'hidden';
                btn.remove();
            });
        }
        
        // Блокируем переключение темы
        function blockThemeToggle() {
            // Перехватываем клики на переключатели темы
            document.addEventListener('click', function(e) {
                const target = e.target.closest('[class*="theme"], [id*="theme"], button[aria-label*="theme"], button[title*="theme"], .theme-toggle');
                if (target) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    return false;
                }
            }, true);
            
            // Переопределяем функцию переключения темы
            if (window.cycleTheme) {
                window.cycleTheme = function() { 
                    document.documentElement.setAttribute('data-theme', 'dark');
                    return false; 
                };
            }
            if (window.setTheme) {
                const originalSetTheme = window.setTheme;
                window.setTheme = function(mode) {
                    if (mode !== 'dark') {
                        originalSetTheme('dark');
                        return;
                    }
                    originalSetTheme(mode);
                };
            }
        }
        
        // Применяем сразу
        hideThemeToggle();
        blockThemeToggle();
        
        // Применяем после загрузки DOM
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                hideThemeToggle();
                blockThemeToggle();
                // Принудительно устанавливаем темную тему
                document.documentElement.setAttribute('data-theme', 'dark');
            });
        } else {
            hideThemeToggle();
            blockThemeToggle();
        }
        
        // Применяем после полной загрузки
        window.addEventListener('load', function() {
            setTimeout(function() {
                hideThemeToggle();
                blockThemeToggle();
                document.documentElement.setAttribute('data-theme', 'dark');
            }, 100);
        });
        
        // Наблюдаем за изменениями DOM
        const observer = new MutationObserver(function(mutations) {
            hideThemeToggle();
            document.documentElement.setAttribute('data-theme', 'dark');
        });
        observer.observe(document.body, {
            childList: true,
            subtree: true,
            attributes: true
        });
    })();
</script>
{% endblock %}
