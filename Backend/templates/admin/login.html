{% extends "admin/login.html" %}
{% load static %}

{% block extrastyle %}
{{ block.super }}
<style>
    /* Устанавливаем primary color #26A17B для Unfold */
    :root {
        --primary-color: #26A17B !important;
        --primary-hover: #1d7a5d !important;
        --primary-light: rgba(38, 161, 123, 0.1) !important;
    }
    
    /* 1. Скрываем кнопку "Return to site" - ВСЕ ВАРИАНТЫ */
    .login-page a[href="/"],
    .login-page a[href="/"]:not([href*="/admin/"]),
    .login-page header a[href="/"],
    .login-page .site-link,
    .login-page .return-link,
    .login-page [class*="return"],
    .login-page [class*="site-link"],
    body.login-page a[href="/"],
    body.login-page header a[href="/"],
    /* Скрываем все ссылки с текстом Return */
    a[href="/"]:not([href*="/admin/"]),
    header a[href="/"]:not([href*="/admin/"]) {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        width: 0 !important;
        height: 0 !important;
        overflow: hidden !important;
        position: absolute !important;
        left: -9999px !important;
        pointer-events: none !important;
    }
    
    /* 2. Светлая тема - черные лейблы */
    [data-theme="light"] .login-page label,
    html[data-theme="light"] .login-page label,
    html:not([data-theme="dark"]) .login-page label,
    [data-theme="light"] label,
    html[data-theme="light"] label,
    html:not([data-theme="dark"]) label {
        color: #000000 !important;
        color: black !important;
    }
    
    /* 3. Светлая тема - черный текст в инпутах */
    [data-theme="light"] .login-page .form-control,
    html[data-theme="light"] .login-page .form-control,
    html:not([data-theme="dark"]) .login-page .form-control,
    [data-theme="light"] .login-page input[type="text"],
    [data-theme="light"] .login-page input[type="password"],
    [data-theme="light"] .login-page input[type="email"],
    html[data-theme="light"] .login-page input[type="text"],
    html[data-theme="light"] .login-page input[type="password"],
    html[data-theme="light"] .login-page input[type="email"],
    html:not([data-theme="dark"]) .login-page input[type="text"],
    html:not([data-theme="dark"]) .login-page input[type="password"],
    html:not([data-theme="dark"]) .login-page input[type="email"] {
        background-color: white !important;
        border: 1px solid #ddd !important;
        color: #000000 !important;
        color: black !important;
    }
    
    [data-theme="light"] .login-page .form-control:focus,
    html[data-theme="light"] .login-page .form-control:focus,
    html:not([data-theme="dark"]) .login-page .form-control:focus,
    [data-theme="light"] .login-page input[type="text"]:focus,
    [data-theme="light"] .login-page input[type="password"]:focus,
    [data-theme="light"] .login-page input[type="email"]:focus {
        background-color: white !important;
        border-color: #26A17B !important;
        color: #000000 !important;
        color: black !important;
        box-shadow: 0 0 0 3px rgba(38, 161, 123, 0.1) !important;
    }
    
    /* 4. Иконки переключателя темы - белые при темной теме */
    [data-theme="dark"] .theme-toggle,
    html[data-theme="dark"] .theme-toggle,
    [data-theme="dark"] .theme-toggle svg,
    html[data-theme="dark"] .theme-toggle svg,
    [data-theme="dark"] .theme-toggle path,
    html[data-theme="dark"] .theme-toggle path,
    [data-theme="dark"] .theme-toggle circle,
    html[data-theme="dark"] .theme-toggle circle,
    [data-theme="dark"] .theme-toggle *,
    html[data-theme="dark"] .theme-toggle *,
    [data-theme="dark"] button[aria-label*="theme"],
    html[data-theme="dark"] button[aria-label*="theme"],
    [data-theme="dark"] button[aria-label*="theme"] svg,
    html[data-theme="dark"] button[aria-label*="theme"] svg {
        color: white !important;
        fill: white !important;
        stroke: white !important;
    }
    
    /* 5. Темная тема - белый текст для "Welcome back to" и всех текстов */
    [data-theme="dark"] .login-page,
    html[data-theme="dark"] .login-page {
        background: #0E1829 !important;
    }
    
    [data-theme="dark"] .login-page label,
    html[data-theme="dark"] .login-page label,
    [data-theme="dark"] .login-page p,
    html[data-theme="dark"] .login-page p,
    [data-theme="dark"] .login-page h1,
    html[data-theme="dark"] .login-page h1,
    [data-theme="dark"] .login-page h2,
    html[data-theme="dark"] .login-page h2,
    [data-theme="dark"] .login-page h3,
    html[data-theme="dark"] .login-page h3,
    [data-theme="dark"] .login-page .login-box-msg,
    html[data-theme="dark"] .login-page .login-box-msg,
    [data-theme="dark"] .login-page .login-box-msg *,
    html[data-theme="dark"] .login-page .login-box-msg *,
    [data-theme="dark"] .login-page span,
    html[data-theme="dark"] .login-page span,
    [data-theme="dark"] .login-page div,
    html[data-theme="dark"] .login-page div {
        color: white !important;
    }
    
    /* Применяем primary color ко всем элементам Unfold */
    [data-theme="light"] [data-unfold],
    [data-theme="dark"] [data-unfold],
    .unfold-primary,
    .btn-primary,
    .button-primary,
    input[type="submit"].default,
    .submit-row input[type="submit"],
    .text-primary,
    .text-primary-500 {
        color: #26A17B !important;
    }
    
    .btn-primary,
    .button-primary,
    input[type="submit"].default,
    .submit-row input[type="submit"],
    input[type="submit"],
    button[type="submit"] {
        background-color: #26A17B !important;
        border-color: #26A17B !important;
        color: white !important;
    }
    
    .btn-primary:hover,
    .button-primary:hover,
    input[type="submit"].default:hover,
    .submit-row input[type="submit"]:hover {
        background-color: #1d7a5d !important;
        border-color: #1d7a5d !important;
        color: white !important;
    }
    
    /* Принудительно заменяем фиолетовые цвета в кнопках */
    .btn-primary,
    .button-primary,
    input[type="submit"],
    button[type="submit"],
    .btn-primary:focus,
    .button-primary:focus,
    input[type="submit"]:focus,
    button[type="submit"]:focus,
    .btn-primary:active,
    .button-primary:active,
    input[type="submit"]:active,
    button[type="submit"]:active,
    .btn-primary:hover,
    .button-primary:hover,
    input[type="submit"]:hover,
    button[type="submit"]:hover {
        background-color: #26A17B !important;
        background: #26A17B !important;
        background-image: none !important;
        border-color: #26A17B !important;
        color: white !important;
    }
    
    /* Принудительно заменяем фиолетовые цвета в фокусе инпутов */
    .form-control:focus,
    input[type="text"]:focus,
    input[type="password"]:focus,
    input[type="email"]:focus,
    textarea:focus,
    select:focus {
        border-color: #26A17B !important;
        box-shadow: 0 0 0 3px rgba(38, 161, 123, 0.1) !important;
        outline-color: #26A17B !important;
    }
    
    /* Скрываем логотип на странице входа */
    .login-page img,
    .login-page img[src*="logo"],
    .login-page [class*="logo"] img,
    .login-page [class*="brand"] img,
    .login-page header img,
    .login-page .unfold-header img,
    .login-page .login-box-msg img,
    .login-page .brand-image,
    .login-page .bg-cover,
    .login-page [class*="bg-cover"],
    .login-page [class*="grow"],
    .login-page [class*="max-w-3xl"],
    .login-page [class*="xl:max-w-4xl"],
    .login-page [class*="xl:block"],
    body.login-page [class*="bg-cover"] {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        width: 0 !important;
        height: 0 !important;
        overflow: hidden !important;
    }
    
    @media (min-width: 1280px) {
        .login-page .bg-cover,
        .login-page [class*="bg-cover"],
        .login-page [class*="xl:block"],
        body.login-page [class*="bg-cover"],
        body.login-page [class*="xl:block"] {
            display: none !important;
        }
    }
</style>
{% endblock %}

{% block extrahead %}
{{ block.super }}
<script>
    (function() {
        'use strict';
        
        // 1. Удаляем кнопку "Return to site"
        function removeReturnButton() {
            const allLinks = document.querySelectorAll('a');
            allLinks.forEach(link => {
                const text = (link.textContent || link.innerText || '').trim();
                const href = link.getAttribute('href') || '';
                
                if ((text.includes('Return') || text.includes('return') || text.includes('←') || text.includes('site')) && 
                    (href === '/' || href === '')) {
                    link.style.setProperty('display', 'none', 'important');
                    link.style.setProperty('visibility', 'hidden', 'important');
                    link.style.setProperty('opacity', '0', 'important');
                    link.style.setProperty('pointer-events', 'none', 'important');
                    try { link.remove(); } catch(e) {}
                }
            });
        }
        
        // 2, 3. Исправляем цвета лейблов и инпутов
        function fixInputColors() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark' || 
                          document.documentElement.classList.contains('dark') ||
                          document.body.classList.contains('dark');
            
            // Лейблы
            const labels = document.querySelectorAll('label');
            labels.forEach(label => {
                if (isDark) {
                    label.style.setProperty('color', 'white', 'important');
                } else {
                    label.style.setProperty('color', '#000', 'important');
                }
            });
            
            // Инпуты
            const inputs = document.querySelectorAll('input[type="text"], input[type="password"], input[type="email"], .form-control');
            inputs.forEach(input => {
                if (isDark) {
                    input.style.setProperty('color', 'white', 'important');
                    input.style.setProperty('background-color', '#2d3136', 'important');
                } else {
                    input.style.setProperty('color', '#000', 'important');
                    input.style.setProperty('background-color', 'white', 'important');
                }
            });
        }
        
        // 4. Исправляем иконки переключателя темы
        function fixThemeToggleIcons() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark' || 
                          document.documentElement.classList.contains('dark') ||
                          document.body.classList.contains('dark');
            
            if (isDark) {
                const themeToggles = document.querySelectorAll('.theme-toggle, button[aria-label*="theme"], [class*="theme"]');
                themeToggles.forEach(toggle => {
                    toggle.style.setProperty('color', 'white', 'important');
                    const svgs = toggle.querySelectorAll('svg, path, circle, line, polyline');
                    svgs.forEach(svg => {
                        svg.style.setProperty('color', 'white', 'important');
                        svg.style.setProperty('fill', 'white', 'important');
                        svg.style.setProperty('stroke', 'white', 'important');
                        svg.setAttribute('fill', 'white');
                        svg.setAttribute('stroke', 'white');
                        const paths = svg.querySelectorAll('path, circle, line, polyline');
                        paths.forEach(path => {
                            path.setAttribute('fill', 'white');
                            path.setAttribute('stroke', 'white');
                            path.style.setProperty('fill', 'white', 'important');
                            path.style.setProperty('stroke', 'white', 'important');
                        });
                    });
                });
            }
        }
        
        // 5. Переводим "Welcome back to" на русский и делаем белым при темной теме
        function translateWelcomeText() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark' || 
                          document.documentElement.classList.contains('dark') ||
                          document.body.classList.contains('dark');
            
            const allElements = document.querySelectorAll('*');
            allElements.forEach(el => {
                if (el.children.length === 0) { // Только листовые элементы
                    const text = el.textContent || el.innerText || '';
                    if (text.includes('Welcome back to')) {
                        el.textContent = text.replace(/Welcome back to/gi, 'Добро пожаловать в');
                        el.innerText = text.replace(/Welcome back to/gi, 'Добро пожаловать в');
                    }
                    
                    if (isDark && (text.includes('Добро пожаловать в') || text.includes('Welcome'))) {
                        el.style.setProperty('color', 'white', 'important');
                    }
                }
            });
        }
        
        // Применяем все исправления
        function applyAllFixes() {
            removeReturnButton();
            fixInputColors();
            fixThemeToggleIcons();
            translateWelcomeText();
        }
        
        // Применяем сразу
        if (document.body) {
            applyAllFixes();
        }
        
        // При загрузке DOM
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                applyAllFixes();
                setTimeout(applyAllFixes, 100);
                setTimeout(applyAllFixes, 500);
            });
        } else {
            applyAllFixes();
            setTimeout(applyAllFixes, 100);
        }
        
        // После полной загрузки
        window.addEventListener('load', function() {
            setTimeout(applyAllFixes, 100);
            setTimeout(applyAllFixes, 500);
            setTimeout(applyAllFixes, 1000);
        });
        
        // Наблюдаем за изменениями
        const observer = new MutationObserver(function() {
            applyAllFixes();
        });
        
        if (document.body) {
            observer.observe(document.body, {
                childList: true,
                subtree: true,
                characterData: true,
                attributes: true,
                attributeFilter: ['data-theme', 'class']
            });
        }
        
        observer.observe(document.documentElement, {
            attributes: true,
            attributeFilter: ['data-theme', 'class']
        });
        
        // Периодическая проверка
        setInterval(applyAllFixes, 500);
    })();
</script>
{% endblock %}
