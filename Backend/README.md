# City Exchange - Django Backend + Telegram Bot

Проект включает в себя Django админ-панель с красивым интерфейсом (Jazmin) и Telegram бота для обменника валют.

## Установка

1. Создайте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # для macOS/Linux
# или
venv\Scripts\activate  # для Windows
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Настройте переменные окружения:
Создайте файл `.env` в корне проекта `Backend/` со следующим содержимым:
```
SECRET_KEY=django-insecure-change-this-in-production-please
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1
TELEGRAM_BOT_TOKEN=8561275717:AAGG26gzvMQiKugJwExb0rDCNcg3H4Aqf_Q
DATABASE_URL=sqlite:///db.sqlite3
```

**Важно:** Токен бота уже указан в примере выше. Убедитесь, что файл `.env` создан перед запуском проекта.

4. Выполните миграции:
```bash
python manage.py migrate
```

5. Создайте суперпользователя:
```bash
python manage.py createsuperuser
```

6. Инициализируйте начальные сообщения бота:
```bash
python manage.py init_messages
```
Эта команда создаст все необходимые типы сообщений с начальными текстами, которые можно будет изменить в админке.

## Запуск

### Запуск Django сервера:
```bash
python manage.py runserver
```

Админ-панель будет доступна по адресу: http://127.0.0.1:8000/admin/

### Запуск Telegram бота:
В отдельном терминале:
```bash
python manage.py run_bot
```

## Функционал админ-панели

1. **Управление сообщениями бота** (`BotMessage`):
   - Стартовое сообщение
   - О нас
   - Курсы
   - AML Проверка
   - Связаться с нами
   - Как нас найти

2. **Управление курсами обмена** (`ExchangeRate`):
   - Добавление/редактирование курсов валют
   - Активация/деактивация курсов

3. **Управление пользователями** (`TelegramUser`):
   - Просмотр списка пользователей бота
   - Отправка сообщений выбранным или всем пользователям

## Функционал Telegram бота

Бот имеет следующие кнопки:
- **О нас** - отправляет настроенное сообщение
- **Курсы** - показывает актуальные курсы обмена
- **AML Проверка** - информация об AML проверке
- **Связаться с нами** - контактная информация
- **Как нас найти** - информация о местоположении

## Структура проекта

```
Backend/
├── config/           # Настройки Django проекта
├── bot/              # Приложение бота
│   ├── models.py     # Модели данных
│   ├── admin.py      # Настройки админки
│   ├── bot.py        # Логика Telegram бота
│   └── views.py      # Представления для админки
├── manage.py
└── requirements.txt
```

## Команды управления

- `python manage.py run_bot` - запуск Telegram бота
- `python manage.py init_messages` - инициализация начальных сообщений бота
- `python manage.py send_message "Текст сообщения"` - отправка сообщения всем пользователям через командную строку

## Отправка сообщений из админки

1. Перейдите в раздел "Пользователи Telegram"
2. Выберите пользователей (или оставьте без выбора для отправки всем)
3. В меню "Действия" выберите "Отправить сообщение выбранным пользователям" или "Отправить сообщение всем пользователям"
4. Введите текст сообщения и нажмите "Отправить"

Также можно использовать ссылку "Отправить сообщение" в верхнем меню админки для отправки всем пользователям.

